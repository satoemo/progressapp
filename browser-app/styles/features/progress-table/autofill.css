/**
 * オートフィル機能のスタイル定義
 * セルの右下に表示されるフィルハンドルと、ドラッグ選択時のハイライト表示
 */

/* フィルハンドル（セル右下の小さな四角） */
.fill-handle {
  position: absolute;
  width: 6px;
  height: 6px;
  background-color: #217346;  /* Excel風の緑色 */
  border: 1px solid #ffffff;
  cursor: crosshair;
  right: -1px;  /* セルの右端から1px外側（2px左に移動） */
  bottom: -1px; /* セルの下端から1px外側（2px上に移動） */
  z-index: var(--z-index-base); /* 固定列・ヘッダーより下層に配置 */
  border-radius: 1px;
  box-sizing: border-box; /* border込みで6px × 6px */
  flex-shrink: 0; /* 縮小を防止 */
  
  /* ホバー時の視覚的フィードバック */
  transition: transform 0.1s ease-in-out;
}

.fill-handle:hover {
  transform: scale(1.2);
  background-color: #1a5d38; /* ホバー時に少し暗く */
}

/* ドラッグ中のフィルハンドル */
.fill-handle.dragging {
  background-color: #1a5d38;
  transform: scale(1.3);
}

/* ソースセル（ドラッグ開始セル）のハイライト */
.autofill-source {
  border: 2px solid #217346 !important;
  background-color: rgba(33, 115, 70, 0.05) !important;
  position: relative;
}

/* ターゲットセル（ドラッグ選択されたセル）のハイライト */
.autofill-target {
  background-color: rgba(33, 115, 70, 0.15) !important;
  border: 1px dashed #217346 !important;
  position: relative;
}

/* 編集可能セルにのみフィルハンドルを表示可能にする */
td.editable-cell {
  position: relative;
}

/* 固定列内のフィルハンドル特別処理 */
.progress-table tbody td:nth-child(1) .fill-handle,
.progress-table tbody td:nth-child(2) .fill-handle {
  z-index: var(--z-index-sticky-cell); /* 固定列と同じレイヤーに配置 */
}

/* スクロール可能領域のフィルハンドル（固定列以外） */
.progress-table tbody td:not(:nth-child(1)):not(:nth-child(2)) .fill-handle {
  z-index: var(--z-index-base); /* 通常レイヤーに配置 */
}

/* セル内要素の基本設定 - フィルハンドル表示のため */
.progress-table tbody td[data-editable="true"] {
  position: relative !important;
  overflow: visible !important; /* フィルハンドルの完全表示を保証 */
}

/* 編集可能セルの基本設定 */
td.editable-cell {
  position: relative !important;
  overflow: visible !important;
}

/* ドラッグ中のカーソル設定 */
body.autofill-dragging {
  cursor: crosshair !important;
}

/* フィルハンドルが表示される編集可能セル用の追加スタイル */
td.editable-cell:hover .fill-handle {
  opacity: 1;
}

td.editable-cell .fill-handle {
  opacity: 0.7;
  transition: opacity 0.2s ease-in-out;
}

/* フィルハンドルをドラッグ時のアニメーション */
@keyframes fill-handle-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.fill-handle.pulse {
  animation: fill-handle-pulse 0.3s ease-in-out;
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
  .fill-handle {
    width: 8px;
    height: 8px;
    right: -2px;
    bottom: -2px;
  }
  
  .fill-handle:hover {
    transform: scale(1.1); /* モバイルでは拡大を少し抑制 */
  }
}

/* タッチデバイス対応 */
@media (hover: none) and (pointer: coarse) {
  .fill-handle {
    width: 10px;
    height: 10px;
    right: -3px;
    bottom: -3px;
    opacity: 0.9;
  }
  
  .fill-handle:active {
    transform: scale(1.1);
    background-color: #1a5d38;
  }
}

/* ハイコントラストモード対応 */
@media (prefers-contrast: high) {
  .fill-handle {
    border: 2px solid #000000;
    background-color: #ffffff;
  }
  
  .autofill-source {
    border: 3px solid #000000 !important;
    background-color: #ffffff !important;
  }
  
  .autofill-target {
    border: 2px dashed #000000 !important;
    background-color: #f0f0f0 !important;
  }
}

/* ダークテーマ対応（将来的な拡張） */
@media (prefers-color-scheme: dark) {
  .fill-handle {
    background-color: #4caf50;
    border-color: #2e2e2e;
  }
  
  .fill-handle:hover {
    background-color: #45a049;
  }
  
  .autofill-source {
    border-color: #4caf50 !important;
    background-color: rgba(76, 175, 80, 0.1) !important;
  }
  
  .autofill-target {
    background-color: rgba(76, 175, 80, 0.2) !important;
    border-color: #4caf50 !important;
  }
}

/* アニメーション無効化設定対応 */
@media (prefers-reduced-motion: reduce) {
  .fill-handle {
    transition: none;
  }
  
  .fill-handle.pulse {
    animation: none;
  }
  
  td.editable-cell .fill-handle {
    transition: none;
  }
}