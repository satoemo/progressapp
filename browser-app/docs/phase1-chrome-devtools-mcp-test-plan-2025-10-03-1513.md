# chrome-devtools-mcpを用いた包括的テスト計画

作成日: 2025-10-03
対象: kintone進捗管理アプリ v10.3.3

## 目次

1. [テスト概要](#テスト概要)
2. [テスト環境](#テスト環境)
3. [テスト計画](#テスト計画)
4. [実行手順](#実行手順)
5. [期待される結果](#期待される結果)

---

## テスト概要

### 目的
chrome-devtools-mcpを活用し、kintone進捗管理アプリの動作確認を自動化・効率化する。
手動テストでは検出が難しい問題や、繰り返し確認が必要な項目を重点的にテストする。

### テスト対象機能
- カット情報のCRUD操作（78フィールド）
- 進捗状況のリアルタイム同期
- メモ機能によるコメント管理
- 複数ビュー（進捗管理、担当者別、シミュレーション、リテイク、香盤、発注、カット袋）
- データのエクスポート機能
- 自動入力機能

### テストアプローチ
各Phaseは独立して実行可能であり、段階的にテストを進める。

---

## テスト環境

### 使用ツール
- **chrome-devtools-mcp**: ブラウザ自動操作とデバッグ
- **Chromium (WSL)**: テスト実行環境
- **test-api-mock.html**: 統一テスト環境

### 前提条件
- WSL内にChromiumがインストール済み
- `/opt/google/chrome/chrome`へのシンボリックリンクが作成済み
- テスト用ビルドが実行済み（`npm run build:test`）

### テストデータ
- ダミーデータ生成機能を使用（50件）
- 各テストフェーズ開始前にストレージをクリア

---

## テスト計画

### Phase 1: 基本動作確認

#### Part 1.1: ページ読み込みとコンソールエラー検出
**目的**: アプリケーションが正常に起動し、致命的なエラーがないことを確認

**テスト手順**:
1. `mcp__chrome-devtools__new_page`でテストページを開く
2. `mcp__chrome-devtools__list_console_messages`でコンソールログを確認
3. エラーレベルのメッセージを検出・分析

**期待結果**:
- ページが正常に読み込まれる
- 致命的なエラーがない（警告は許容）
- "アプリ初期化完了"のログが出力される

#### Part 1.2: UI要素の存在確認
**目的**: 主要なUI要素が正しくレンダリングされていることを確認

**テスト手順**:
1. `mcp__chrome-devtools__take_snapshot`でページ構造を取得
2. 以下の要素の存在を確認:
   - メインタブ（進捗管理、担当者別、シミュレーション等）
   - ヘッダーボタン（詳細表示、進捗表示、情報表示等）
   - テーブルヘッダー（カット番号、ステータス等）
   - コントロールボタン（ダミーデータ生成、ストレージクリア）

**期待結果**:
- すべての主要UI要素が存在する
- テーブルが正しく表示される（初期状態：データなし）

#### Part 1.3: 初期状態のスクリーンショット
**目的**: 視覚的な初期状態を記録

**テスト手順**:
1. `mcp__chrome-devtools__take_screenshot`で全画面をキャプチャ
2. 初期状態のレイアウトを確認

**期待結果**:
- レイアウト崩れがない
- すべてのUI要素が適切に配置されている

---

### Phase 2: データ操作テスト

#### Part 2.1: ダミーデータ生成
**目的**: データ生成機能が正常に動作することを確認

**テスト手順**:
1. `mcp__chrome-devtools__click`で「ダミーデータ生成 (50件)」ボタンをクリック
2. `mcp__chrome-devtools__handle_dialog`でアラートを処理
3. `mcp__chrome-devtools__list_console_messages`でエラーを確認
4. `mcp__chrome-devtools__take_snapshot`でデータが表示されているか確認

**期待結果**:
- 50件のカットデータが生成される（一部失敗は許容、既知の問題）
- テーブルにデータが表示される
- 生成エラーの件数が許容範囲内（5件以下）

#### Part 2.2: カットデータの表示確認
**目的**: 生成されたデータが正しく表示されることを確認

**テスト手順**:
1. `mcp__chrome-devtools__take_snapshot`でテーブル内容を確認
2. 以下の項目が表示されているか確認:
   - カット番号（002, 008, 010等）
   - ステータス（3D LOチェックまち等）
   - 特殊（エフェクト、3D等）
   - 枚数
   - 制作、演出、総作監等の基本情報

**期待結果**:
- データが正しくテーブルに表示される
- フィールドのフォーマットが適切（数値、日付等）

#### Part 2.3: カットの削除
**目的**: カット削除機能が正常に動作することを確認

**テスト手順**:
1. `mcp__chrome-devtools__take_snapshot`で削除ボタンのuidを取得
2. `mcp__chrome-devtools__click`で特定のカットの削除ボタンをクリック
3. 確認ダイアログが表示されたら`mcp__chrome-devtools__handle_dialog`で処理
4. `mcp__chrome-devtools__list_console_messages`で削除処理のログを確認
5. `mcp__chrome-devtools__take_snapshot`でカットが削除されたか確認

**期待結果**:
- カットが正常に削除される
- テーブルから該当行が消える
- 削除イベントのログが出力される

---

### Phase 3: タブとビュー切り替えテスト

#### Part 3.1: タブ切り替え動作
**目的**: 各タブが正常に切り替わることを確認

**テスト手順**:
1. `mcp__chrome-devtools__take_snapshot`で各タブのuidを取得
2. 以下の順でタブをクリック:
   - 進捗管理 → 担当者別 → シミュレーション → リテイク表 → 香盤表 → 発注伝票 → カット袋出力
3. 各タブクリック後に`mcp__chrome-devtools__take_screenshot`でキャプチャ
4. `mcp__chrome-devtools__list_console_messages`でエラーを確認

**期待結果**:
- すべてのタブが正常に切り替わる
- 各ビューが適切に表示される
- タブ切り替え時にエラーが発生しない

#### Part 3.2: ビュー固有の機能確認
**目的**: 各ビューの特有機能が動作することを確認

**テスト手順**:
1. 各ビューで`mcp__chrome-devtools__take_snapshot`を実行
2. ビュー固有のUI要素を確認:
   - シミュレーション: グラフやチャート要素
   - 担当者別: スタッフ一覧
   - リテイク表: リテイク情報

**期待結果**:
- 各ビューの特有要素が表示される
- データが適切にフィルタリング・集計されている

---

### Phase 4: フィルタ・ソート機能テスト

#### Part 4.1: フィルタ機能
**目的**: テーブルのフィルタ機能が正常に動作することを確認

**テスト手順**:
1. カット番号列の▼ボタンをクリック
2. `mcp__chrome-devtools__take_snapshot`でフィルタポップアップを確認
3. 特定の値を選択（例: "002"）
4. フィルタ適用後のテーブルを`mcp__chrome-devtools__take_snapshot`で確認

**期待結果**:
- フィルタポップアップが表示される
- フィルタ適用後、該当データのみが表示される
- フィルタ条件がUIに反映される

#### Part 4.2: ソート機能
**目的**: テーブルのソート機能が正常に動作することを確認

**テスト手順**:
1. カット番号列の▲/▼ボタンをクリック
2. `mcp__chrome-devtools__take_snapshot`でソート後のデータを確認
3. 昇順・降順の切り替えを確認

**期待結果**:
- ソートが正常に適用される
- データが正しい順序で表示される
- ソート方向がUIに反映される

---

### Phase 5: メモ機能テスト

#### Part 5.1: メモの追加・編集
**目的**: セルメモ機能が正常に動作することを確認

**テスト手順**:
1. 任意のセルをダブルクリック
2. `mcp__chrome-devtools__take_snapshot`でメモポップアップを確認
3. `mcp__chrome-devtools__fill`でメモ内容を入力
4. 保存ボタンをクリック
5. `mcp__chrome-devtools__list_console_messages`でメモ保存ログを確認

**期待結果**:
- メモポップアップが正常に表示される
- メモが正常に保存される
- セルにメモアイコンが表示される

#### Part 5.2: メモの表示確認
**目的**: 保存したメモが正しく表示されることを確認

**テスト手順**:
1. メモが保存されたセルを再度クリック
2. `mcp__chrome-devtools__take_snapshot`でメモ内容を確認
3. メモ内容が保持されているか確認

**期待結果**:
- メモ内容が正しく表示される
- メモの編集履歴が保持される

---

### Phase 6: エクスポート機能テスト

#### Part 6.1: PDFエクスポート
**目的**: PDF出力機能が動作することを確認

**テスト手順**:
1. `mcp__chrome-devtools__click`で「PDF出力」ボタンをクリック
2. `mcp__chrome-devtools__list_console_messages`でエクスポート処理のログを確認
3. エラーや警告がないか確認

**期待結果**:
- PDFエクスポート処理が開始される
- 処理完了のログが出力される
- エラーが発生しない

---

### Phase 7: パフォーマンステスト

#### Part 7.1: レンダリング性能
**目的**: 大量データでのレンダリング性能を確認

**テスト手順**:
1. 50件のダミーデータを生成
2. `mcp__chrome-devtools__performance_start_trace`でトレース開始
3. タブ切り替えやフィルタ操作を実行
4. `mcp__chrome-devtools__performance_stop_trace`でトレース停止
5. パフォーマンス指標を確認

**期待結果**:
- レンダリングが1秒以内に完了
- メモリ使用量が適切な範囲内
- FPS（Frame Per Second）が30以上を維持

#### Part 7.2: ネットワークリクエスト確認
**目的**: 不要なネットワークリクエストがないことを確認

**テスト手順**:
1. `mcp__chrome-devtools__list_network_requests`でリクエスト一覧を取得
2. 以下を確認:
   - 必要なリソースのみが読み込まれているか
   - 404エラーがないか
   - 重複リクエストがないか

**期待結果**:
- 必要最小限のリクエストのみ
- すべてのリクエストが成功（200 OK）
- 無駄な重複リクエストがない

---

### Phase 8: エラーハンドリングテスト

#### Part 8.1: 異常データの処理
**目的**: 異常なデータが適切に処理されることを確認

**テスト手順**:
1. `mcp__chrome-devtools__evaluate_script`で異常データを挿入:
   ```javascript
   // 不正なカット番号
   facade.createCut({ cutNumber: "ABC" })
   // 存在しないフィールド
   facade.createCut({ invalidField: "test" })
   ```
2. `mcp__chrome-devtools__list_console_messages`でエラーログを確認

**期待結果**:
- バリデーションエラーが適切に表示される
- アプリケーションがクラッシュしない
- エラーメッセージが分かりやすい

#### Part 8.2: 境界値テスト
**目的**: 境界値での動作を確認

**テスト手順**:
1. 以下の境界値でデータを作成:
   - カット番号: "000", "999", "001"
   - 枚数: 0, 1, 999
   - 文字列: 空文字、超長文
2. 各ケースで動作を確認

**期待結果**:
- 境界値が適切に処理される
- エラーが発生した場合、適切なメッセージが表示される

---

### Phase 9: ストレージとデータ永続化テスト

#### Part 9.1: LocalStorageの動作確認
**目的**: データが正しくLocalStorageに保存されることを確認

**テスト手順**:
1. ダミーデータを生成
2. `mcp__chrome-devtools__evaluate_script`でLocalStorageの内容を確認:
   ```javascript
   Object.keys(localStorage).filter(k => k.includes('cut') || k.includes('mock'))
   ```
3. データの構造を確認

**期待結果**:
- カットデータがLocalStorageに保存される
- データ構造が正しい（JSON形式）
- 不要なデータが保存されていない

#### Part 9.2: ページリロード後のデータ保持
**目的**: ページリロード後もデータが保持されることを確認

**テスト手順**:
1. ダミーデータを生成
2. `mcp__chrome-devtools__navigate_page`でページをリロード
3. `mcp__chrome-devtools__take_snapshot`でデータが保持されているか確認

**期待結果**:
- リロード後もデータが表示される
- 表示状態（フィルタ、ソート等）が保持される

#### Part 9.3: ストレージクリア機能
**目的**: ストレージクリア機能が正常に動作することを確認

**テスト手順**:
1. ダミーデータを生成
2. `mcp__chrome-devtools__click`で「ストレージクリア」ボタンをクリック
3. `mcp__chrome-devtools__handle_dialog`で確認ダイアログを処理
4. ページリロード後、データが削除されているか確認

**期待結果**:
- すべてのアプリケーションデータが削除される
- テーブルが空の状態に戻る
- コンソールに削除件数が表示される

---

### Phase 10: 統合テスト

#### Part 10.1: 一連の操作フロー
**目的**: 実際の使用シナリオに沿った一連の操作が正常に動作することを確認

**テスト手順**:
1. ダミーデータ生成（50件）
2. カット番号でフィルタ適用
3. 特定のカットを選択してメモを追加
4. カットデータを更新
5. 担当者別タブに切り替え
6. PDFエクスポート実行
7. ストレージクリア

各ステップで:
- `mcp__chrome-devtools__list_console_messages`でエラー確認
- `mcp__chrome-devtools__take_screenshot`で状態を記録

**期待結果**:
- すべての操作が正常に完了する
- 致命的なエラーが発生しない
- データの整合性が保たれる

---

## 実行手順

### 準備
1. WSL環境でプロジェクトディレクトリに移動
2. テスト用ビルドを実行:
   ```bash
   cd v10.3.3
   npm run build:test
   ```

### テスト実行
Claude Codeで以下を実行:

```
1. Phase 1から順番にテストを実行
2. 各Phaseの結果を記録
3. エラーが発生した場合は詳細を記録
4. すべてのPhaseが完了したら総合レポートを作成
```

### 自動化スクリプト例

```javascript
// Phase 1: 基本動作確認
async function runPhase1() {
  // Part 1.1: ページ読み込み
  await mcp__chrome-devtools__new_page({
    url: "file:///home/yamada/claudeproject/kintone/v10.3.3/test/test-api-mock.html"
  });

  const consoleMessages = await mcp__chrome-devtools__list_console_messages();
  const errors = consoleMessages.filter(m => m.level === 'error');

  // Part 1.2: UI要素確認
  const snapshot = await mcp__chrome-devtools__take_snapshot();

  // Part 1.3: スクリーンショット
  await mcp__chrome-devtools__take_screenshot({
    filePath: "/home/yamada/claudeproject/kintone/v10.3.3/test/screenshots/phase1-initial.png"
  });

  return {
    errors: errors.length,
    uiElements: snapshot.includes('進捗管理'),
    screenshot: 'saved'
  };
}
```

---

## 期待される結果

### 成功基準
各Phaseで以下の基準を満たすこと:

**Phase 1: 基本動作確認**
- [ ] ページが正常に読み込まれる
- [ ] 致命的なエラーが0件
- [ ] 主要UI要素がすべて存在

**Phase 2: データ操作テスト**
- [ ] ダミーデータが生成される（成功率90%以上）
- [ ] カット削除が正常に動作
- [ ] データが正しく表示される

**Phase 3: タブ切り替えテスト**
- [ ] すべてのタブが切り替わる
- [ ] 各ビューが正常に表示される
- [ ] タブ切り替え時のエラーが0件

**Phase 4: フィルタ・ソート**
- [ ] フィルタが正常に適用される
- [ ] ソートが正常に動作する

**Phase 5: メモ機能**
- [ ] メモが追加・編集できる
- [ ] メモが正しく保存・表示される

**Phase 6: エクスポート**
- [ ] PDFエクスポートが動作する
- [ ] エラーが発生しない

**Phase 7: パフォーマンス**
- [ ] レンダリングが1秒以内
- [ ] メモリ使用量が適切
- [ ] 不要なリクエストがない

**Phase 8: エラーハンドリング**
- [ ] 異常データが適切に処理される
- [ ] アプリケーションがクラッシュしない

**Phase 9: ストレージ**
- [ ] データが正しく保存される
- [ ] ページリロード後も保持される
- [ ] ストレージクリアが動作する

**Phase 10: 統合テスト**
- [ ] 一連の操作が完了する
- [ ] データ整合性が保たれる

### 既知の問題
以下は既知の問題であり、テスト失敗としてカウントしない:

1. **ダミーデータ生成の部分的な失敗**
   - 50件中5-10件程度の生成失敗は許容
   - 原因: 非同期処理のタイミング問題

2. **コンソール警告メッセージ**
   - kintone環境ではないためのスキップメッセージ
   - これは正常な動作

3. **一部ビューの未実装機能**
   - 香盤表、発注伝票、カット袋出力は一部未実装
   - 「未実装」の表示は正常

---

## テスト結果の記録

### 結果フォーマット

```markdown
# テスト実行結果

実行日時: YYYY-MM-DD HH:MM
実行者: Claude Code (chrome-devtools-mcp)

## Phase 1: 基本動作確認
- Part 1.1: ✅ 成功
- Part 1.2: ✅ 成功
- Part 1.3: ✅ 成功

## Phase 2: データ操作テスト
- Part 2.1: ⚠️ 部分的成功（50件中45件生成）
- Part 2.2: ✅ 成功
- Part 2.3: ✅ 成功

（以下略）

## 総合評価
- 成功: XX/YY
- 部分的成功: XX/YY
- 失敗: XX/YY

## 発見された問題
1. [問題の説明]
2. [問題の説明]

## 推奨事項
1. [改善提案]
2. [改善提案]
```

---

## 次のステップ

テスト完了後:

1. **結果分析**: 各Phaseの結果を分析し、問題点を特定
2. **バグ修正**: 発見されたバグを優先度順に修正
3. **ドキュメント更新**: テスト結果を元にドキュメントを更新
4. **リグレッションテスト**: 修正後、再度全テストを実行

---

*このテスト計画は、chrome-devtools-mcpを最大限活用し、効率的かつ包括的なテストを実現するために作成されました。*
